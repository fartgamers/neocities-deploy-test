<!DOCTYPE html>
<html>
	<head>
		<title>CURRENTLY LiSTENiNG TO</title>
		<link rel="icon" type="image/x-icon" href="/favicon.png">
		<link rel="apple-touch-icon" sizes="180x180" href="media/favicons/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="media/favicons/32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="media/favicons/16.png">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>
	<div class="content" style="margin: 0; position: relative; overflow: hidden;" id="main">
		<div id="moneyOnMind" class="moneyOnMind"></div>
		<div class="moneyOnMind" id="fartOnMind" style="animation: otherRotate 75s linear infinite; opacity: 0.75; z-index: 1; mix-blend-mode: multiply;"></div>
		<div id="hiPoopFart">
			<p id="listen" user="wiichicken">CANT FETCH (TRY REFRESHiNG)</p>
			<div id="artworklink" target="_blank">
				<img id="artwork" src="" onError="this.onerror=null;this.src='/resources/widgets/home/med/blank.png';">
				<p id="track"></p>
			</div>
		</div>
	</div>
	<div id="controls">
		<p id="control-header">Settings</p>
		<div id="control-area">
			<div class="c-row" onclick="enableHorizontal();" id="en-hor">
				<img src="media/np/horizontal.png">
				<p>Layout</p>
				<button class="toggle-button" id="layout-mode" onclick="toggleLayout();">Horizontal</button>
			</div>
			<div class="c-row">
				<img src="media/np/listener.png" onclick="setUser()" title="Set username">
				<p>Set username</p>
			</div>
		</div>
	</div>
	<div id="enter-name">
		<form onsubmit="event.preventDefault(); confirmUser()">
			<input type="text" id="username" name="username">
			<img src="media/np/continue.png" onclick="confirmUser()" title="Confirm">
		</form>
	</div>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Martian+Mono:wght@600&family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap');
		* {box-sizing: border-box;}
		::-webkit-scrollbar {width: 0;}
		body {
			font-family: 'Ubuntu', sans-serif;
			margin: 0;
			color: white;
			overflow-x: hidden;
		}
		.content p {text-shadow: 0px 0px 5px #00000099;}
		#listen {
			text-shadow: 0px 0px 5px #00000099;
			font-family: 'Martian Mono', monospace;
			font-size: 20px;
			margin-block-start: 0;
			margin-block-end: 5px;
		}
		.content {max-height: 100vh;}
		.moneyOnMind {
			width: 100vmax;
			height: 100vmax;
			position: absolute;
			z-index: 0;
			background-size: 80vmax;
			background-repeat: repeat;
			animation: rotate 45s linear infinite;
			scale: 1.5;
		}
		#artwork {
			display: inline-block;
			box-shadow: 0px 0px 50px 0px #ffffff4d;
			border: 1px solid white;
			width: 30vmin;
			max-width: 300px;
		}
		#listenglow {
			text-shadow: 0px 0px 5px #00000099, #ffffff56 0 0 10px;
			font-weight: bold;
		}
		#artworklink {
			display: flex;
			align-items: center;
			justify-content: center;
		}
		#hiPoopFart {
			backdrop-filter: blur(80px) saturate(2);
			-webkit-backdrop-filter: blur(80px) saturate(2);
			position: relative;
			z-index: 1;
			background-color: rgba(49, 49, 49, 0.4);
			width: 100vw;
			height: 100vh;
			object-fit: contain;
			margin: 0;
			display: flex;
			justify-content: center;
			flex-direction: column;
			align-items: center;
		}
		@keyframes nowBack {
			0% {background-position-y: 0%; background-position-x: 0%; transform: rotate(0deg);}
			20% {background-position-x: 113%; background-position-y: 213%;}
			40% {background-position-x: 226%; background-position-y: 426%;}
			60% {background-position-x: 339%; background-position-y: 639%;}
			80% {background-position-x: 452%; background-position-y: 852%;}
			100% {background-position-y: 1065%; background-position-x: 565%; transform: rotate(360deg);}
		}
		@keyframes nowFront {
			0% {background-position-y: 0%; background-position-x: 0%; transform: rotateY(360deg);}
			20% {background-position-x: -113%; background-position-y: -213%;}
			40% {background-position-x: -226%; background-position-y: -426%;}
			60% {background-position-x: -339%; background-position-y: -639%;}
			80% {background-position-x: -452%; background-position-y: -852%;}
			100% {background-position-y: -1065%; background-position-x: -565%; transform: rotateY(0deg);}
		}
		@keyframes rotate {
			0% {transform: rotate(360deg);}
			100% {transform: rotate(0deg);}
		}
		@keyframes otherRotate {
			0% {transform: rotate3d(0, 0, 0, 0deg);}
			100% {transform: rotate3d(2, 5, 8, 359deg);}
		}
		#controls, #enter-name {
			background-color: #79747e6f;
			border: 1px solid #CAC4D0;
			z-index: 10;
		}
		#controls {
			position: absolute;
			right: 15px;
			bottom: 15px;
			opacity: 0.3;
			transition-duration: 0.5s;
		}
		#controls img {image-rendering: pixelated;}
		#controls p {
			margin-block-start: 0;
			margin-block-end: 0;
		}
		#controls:hover {opacity: 1;}
		#controls button {
			border: 1px solid #CAC4D0;
			padding: 5px;
			box-shadow: 2px 2px 0 0;
			font-size: 10px;
			background-color: unset;
			color: #CAC4D0;
			width: 70px;
			cursor: pointer;
			position: relative;
		}
		#controls button:hover {
			box-shadow: 1px 1px 0 0;
			transform: translate(1px, 1px);
		}
		#controls button:active {
			box-shadow: unset;
			transform: translate(2px, 2px);
		}
		#control-area {
			display: flex;
			flex-direction: column;
			justify-content: center;
			gap: 5px;
			padding: 5px;
		}
		#control-header {
			text-align: center;
			font-size: 9px;
			width: 100%;
			background-color: #CAC4D0;
			color: #2c2b2e;
			font-weight: bold;
		}
		.c-row {
			display: flex;
			align-items: center;
			gap: 5px;
			padding: 5px;
			border: 1px solid #CAC4D0;
		}
		.c-row img {
			width: 20px;
			height: 20px;
		}
		#enter-name {
			position: absolute;
			bottom: 65px;
			right: 10px;
			height: 22px;
			display: none;
		}
		#username {
			background: none;
			border: none;
			border-bottom: 1px solid #CAC4D0;
			color: #CAC4D0;
		}
		/* styles for when in portrait */
		.portrait #hiPoopFart #artworklink {flex-direction: column;}
		.portrait #hiPoopFart #artworklink #track {
			text-align: center;
			font-size: 4vmin;
		}
		.portrait #hiPoopFart #artworklink #track strong {font-size: 5vmin;}
		/* styles for when in landscape */
		.landscape #hiPoopFart #artworklink {
			flex-direction: row;
			align-items: flex-end;
		}
		.landscape #hiPoopFart #artworklink #track {
			margin-block-end: 0;
			margin-left: 15px;
			text-align: left;
			font-size: 2.5vmax;
		}
		.landscape #hiPoopFart #artworklink #track strong {font-size: 3vmax;}
		.landscape #hiPoopFart {
			align-items: flex-start;
			padding: 15px;
		}
		.landscape #hiPoopFart #artworklink #artwork {width: 20vmax;}
		/* whatever */
		.noBg #moneyOnMind, .noBg #fartOnMind {display: none;}
		@media (prefers-reduced-motion) {
			* {animation: none !important;}
		}
		@media (prefers-reduced-transparency) {
			.content {background-image: none !important;}
			#hiPoopFart {
				backdrop-filter: blur(0px) !important;
				-webkit-backdrop-filter: blur(0px); 
				background-color: black;
			}
		}
	</style>
	<script>
		var mainElement = document.getElementById('main');
		let user = 'wiichicken';
		function getNowPlaying() {
			var url = `http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${user}&api_key=93016c14b5580e5f2a72cdc9413cfa36&limit=1&format=json`;
			var request = new XMLHttpRequest();
			request.open('GET', url, true);
	
			request.onload = function() {
				if (request.status >= 200 && request.status < 400) {
					var data = JSON.parse(request.responseText);
					var artist = data.recenttracks.track[0].artist["#text"];
					var song = data.recenttracks.track[0]["name"];
					var artwork = data.recenttracks.track[0].image[3]["#text"];
					var tinyArtwork = data.recenttracks.track[0].image[0]["#text"];
	
					var artworkImg = document.getElementById("artwork");
					artworkImg.setAttribute("src", artwork);
					var fakeBlur = document.getElementById('moneyOnMind');
					fakeBlur.style.backgroundImage = `url(${tinyArtwork})`;
					document.getElementById('fartOnMind').style.backgroundImage = `url(${tinyArtwork})`;
	
					var trackInfo = document.getElementById("track");
					trackInfo.innerHTML = "\
						<strong>"+song+"</strong><br />\
						"+artist+"\
					";
	
					if (typeof data.recenttracks.track[0]["@attr"] !== "undefined"){
						var listenInfo = document.getElementById("listen");
						listenInfo.innerHTML = '<span id="listenglow">LiSTENiNG</span> TO:';
					} else {
						var listenInfo = document.getElementById("listen");
						listenInfo.innerHTML = 'last <span>listened</span> to:';
						console.log("false");
					}
				} else {console.error("Error fetching data from server.");}
			};
			request.onerror = function() {console.error("Connection error.");};
			request.send();
		}
		document.addEventListener('DOMContentLoaded', getNowPlaying());
		function detectSize() {
			if (window.innerHeight >= window.innerWidth) {
				mainElement.classList.add('portrait');
				document.getElementById('layout-mode').innerHTML = 'Portrait';
			} else {
				mainElement.classList.add('landscape');
				document.getElementById('layout-mode').innerHTML = 'Landscape';
			}
		}
		function toggleLayout() {
			if (mainElement.classList.contains('portrait')) {
				mainElement.classList.replace('portrait', 'landscape');
				document.getElementById('layout-mode').innerHTML = 'Landscape';
			} else {
				mainElement.classList.replace('landscape', 'portrait');
				document.getElementById('layout-mode').innerHTML = 'Portrait';
			}
		}
		function enableHorizontal() {
			document.getElementById('en-hor').classList.add('active-button');
			document.getElementById('en-vert').classList.remove('active-button');
		}
		function enableVertical() {
			mainElement.classList.replace('landscape', 'portrait');
			document.getElementById('en-vert').classList.add('active-button');
			document.getElementById('en-hor').classList.remove('active-button');
		}
		function setUser() {
			document.getElementById('enter-name').style.display = 'block';
			document.getElementById('username').value = user;
		}
		function confirmUser() {
			user = document.getElementById('username').value;
			document.getElementById('enter-name').style.display = 'none';
			getNowPlaying();
		}
		detectSize();
		setInterval(function(){getNowPlaying()}, 15000);
		let fadeTimeout, isHovered = false;
		let controls = document.querySelector('#controls');
		function fadeOut() {
			if (!isHovered) {
				controls.style.transition = 'opacity 0.5s';
				controls.style.opacity = '0';
			}
		}
		function fadeIn() {
			controls.style.transition = 'opacity 0.5s';
			controls.style.opacity = '1';
			clearTimeout(fadeTimeout);
			fadeTimeout = setTimeout(fadeOut, 5000);
		}
		// shows the controls if the mouse is moved or screen is tapped
		document.addEventListener('mousemove', () => {fadeIn();});
		document.addEventListener('touchstart', () => {fadeIn();});
		controls.addEventListener('mouseenter', () => {
			isHovered = true;
			clearTimeout(fadeTimeout);
		});
		// prevents controls from being automatically hidden when hovered over
		controls.addEventListener('mouseleave', () => {
			isHovered = false;
			fadeTimeout = setTimeout(fadeOut, 5000);
		});
		fadeTimeout = setTimeout(fadeOut, 5000);
	</script>
	</body>
</html>